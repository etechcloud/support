{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Description": "Read Only and Support role to allow partner to have visibility of the customer account",
    "Parameters" : {
        "PartnerAccountParameter" : {
            "Description" : "Please enter the partner's account ID. Type the 12-digit account number",
            "Type" : "String",
            "MinLength" : 12,
            "MaxLength" : 12
        }
    },
    "Resources": {
        "IAMRole00PartnerLedSupport00a2XsW": {
            "UpdateReplacePolicy": "Retain",
            "Type": "AWS::IAM::Role",
            "DeletionPolicy": "Delete",
            "Properties": {
                "Path": "/",
                "ManagedPolicyArns": [
                    "arn:aws:iam::aws:policy/AWSSupportAccess",
                    "arn:aws:iam::aws:policy/ReadOnlyAccess"
                ],
                "MaxSessionDuration": 3600,
                "RoleName": "etech-support",
                "Description": "",
                "Policies": [
                    {
                        "PolicyDocument": {
                            "Version": "2012-10-17",
                            "Statement": [
                                {
                                    "Resource": "*",
                                    "Action": [
                                        "acm-pca:describeCertificateAuthority",
                                        "acm-pca:describeCertificateAuthorityAuditReport",
                                        "acm-pca:getCertificateAuthorityCertificate",
                                        "acm-pca:getCertificateAuthorityCsr",
                                        "acm-pca:ListCertificateAuthorities",
                                        "acm-pca:listTags",
                                        "acm:describeCertificate",
                                        "acm:getCertificate",
                                        "acm:listCertificates",
                                        "acm:listTagsForCertificate",
                                        "cloudfront:listDistributionsByWebACLId",
                                        "cloudtrail:DescribeTrails",
                                        "cloudtrail:GetEventSelectors",
                                        "cloudtrail:lookupEvents",
                                        "cloudwatch:getDashboard",
                                        "cloudwatch:getMetricData",
                                        "cloudwatch:listDashboards",
                                        "cloudwatch:listMetrics",
                                        "codepipeline:getPipeline",
                                        "codepipeline:getPipelineState",
                                        "codepipeline:listActionTypes",
                                        "codepipeline:listPipelines",
                                        "codepipeline:ListPipelineExecutions",
                                        "ec2:describeByoipCidrs",
                                        "ec2:describeCapacityReservations",
                                        "ec2:describeDhcpOptions",
                                        "ec2:describeNatGateways",
                                        "ec2:describeNetworkAcls",
                                        "ec2:describeNetworkInterfaces",
                                        "ec2:describePublicIpv4Pools",
                                        "ec2:describeRouteTables",
                                        "ec2:describeSecurityGroups",
                                        "ec2:describeSpotFleetRequests",
                                        "ec2:describeSpotInstanceRequests",
                                        "ec2:describeSubnets",
                                        "ec2:describeVpcs",
                                        "elasticfilesystem:describeAccessPoints",
                                        "elasticfilesystem:describeFileSystemPolicy",
                                        "elasticfilesystem:describeFileSystems",
                                        "elasticfilesystem:describeLifecycleConfiguration",
                                        "elasticfilesystem:describeMountTargets",
                                        "elasticfilesystem:listTagsForResource",
                                        "elasticloadbalancing:DescribeListeners",
                                        "elasticloadbalancing:DescribeLoadBalancers",
                                        "elasticloadbalancing:describeTags",
                                        "elasticloadbalancing:describeTargetGroups",
                                        "elasticloadbalancing:describeTargetHealth",
                                        "events:describeRule",
                                        "events:listEventBuses",
                                        "events:listEventSources",
                                        "events:listRules",
                                        "events:listTargetsByRule",
                                        "guardduty:getFindings",
                                        "guardduty:listDetectors",
                                        "guardduty:listFindings",
                                        "guardduty:listIPSets",
                                        "guardduty:listThreatIntelSets",
                                        "iam:getAccessKeyLastUsed",
                                        "iam:getGroupPolicy",
                                        "iam:getPolicy",
                                        "iam:getPolicyVersion",
                                        "iam:getRole",
                                        "iam:getRolePolicy",
                                        "iam:getServerCertificate",
                                        "iam:getUser",
                                        "iam:getUserPolicy",
                                        "iam:listAccessKeys",
                                        "iam:listAttachedGroupPolicies",
                                        "iam:listAttachedRolePolicies",
                                        "iam:listAttachedUserPolicies",
                                        "iam:listGroupPolicies",
                                        "iam:listGroupsForUser",
                                        "iam:listInstanceProfiles",
                                        "iam:listMFADevices",
                                        "iam:listPolicies",
                                        "iam:listPolicyVersions",
                                        "iam:listRolePolicies",
                                        "iam:listRoles",
                                        "iam:listServerCertificates",
                                        "iam:listSSHPublicKeys",
                                        "iam:listUserPolicies",
                                        "iam:listUsers",
                                        "iam:listVirtualMFADevices",
                                        "lambda:getAccountSettings",
                                        "lambda:getFunction",
                                        "lambda:getPolicy",
                                        "lambda:listAliases",
                                        "lambda:listEventSourceMappings",
                                        "lambda:listFunctionEventInvokeConfigs",
                                        "lambda:listFunctions",
                                        "lambda:listLayers",
                                        "lambda:listProvisionedConcurrencyConfigs",
                                        "lambda:listVersionsByFunction",
                                        "logs:describeExportTasks",
                                        "logs:describeLogGroups",
                                        "logs:describeLogStreams",
                                        "logs:describeMetricFilters",
                                        "logs:describeSubscriptionFilters",
                                        "medialive:listChannels",
                                        "medialive:listInputs",
                                        "medialive:listInputSecurityGroups",
                                        "mobiletargeting:GetAdmChannel",
                                        "mobiletargeting:GetApnsChannel",
                                        "mobiletargeting:GetApnsSandboxChannel",
                                        "mobiletargeting:GetApnsVoipChannel",
                                        "mobiletargeting:GetApnsVoipSandboxChannel",
                                        "mobiletargeting:GetApplicationSettings",
                                        "mobiletargeting:GetApps",
                                        "mobiletargeting:GetBaiduChannel",
                                        "mobiletargeting:GetCampaign",
                                        "mobiletargeting:GetCampaignActivities",
                                        "mobiletargeting:GetCampaignVersions",
                                        "mobiletargeting:GetEmailChannel",
                                        "mobiletargeting:GetEventStream",
                                        "mobiletargeting:GetExportJobs",
                                        "mobiletargeting:GetGcmChannel",
                                        "mobiletargeting:GetImportJobs",
                                        "mobiletargeting:GetJourney",
                                        "mobiletargeting:GetJourneyExecutionActivityMetrics",
                                        "mobiletargeting:GetJourneyExecutionMetrics",
                                        "mobiletargeting:GetJourneyRuns",
                                        "mobiletargeting:GetSegment",
                                        "mobiletargeting:GetSegmentImportJobs",
                                        "mobiletargeting:GetSegmentVersions",
                                        "mobiletargeting:GetSmsChannel",
                                        "polly:describeVoices",
                                        "polly:listLexicons",
                                        "rds:describeDBClusterParameterGroups",
                                        "rds:describeDBClusterParameters",
                                        "rds:describeDBClusters",
                                        "rds:describeDBClusterSnapshots",
                                        "rds:describeDBInstances",
                                        "rds:describeDBParameterGroups",
                                        "rds:describeDBParameters",
                                        "rds:describeDBSecurityGroups",
                                        "rds:describeDBSnapshots",
                                        "rds:describeDBSubnetGroups",
                                        "rds:describeEvents",
                                        "rds:describePendingMaintenanceActions",
                                        "rds:listTagsForResource",
                                        "redshift:describeClusterParameterGroups",
                                        "redshift:describeClusterParameters",
                                        "redshift:describeClusters",
                                        "redshift:describeClusterSnapshots",
                                        "redshift:describeClusterSubnetGroups",
                                        "redshift:describeEvents",
                                        "redshift:describeEventSubscriptions",
                                        "redshift:describeLoggingStatus",
                                        "redshift:describeReservedNodes",
                                        "redshift:describeResize",
                                        "route53domains:getDomainDetail",
                                        "route53domains:getOperationDetail",
                                        "route53domains:listDomains",
                                        "route53domains:listOperations",
                                        "ssm:describeActivations",
                                        "ssm:describeAutomationExecutions",
                                        "ssm:describeInstanceInformation",
                                        "ssm:describeMaintenanceWindows",
                                        "ssm:describeParameters",
                                        "ssm:describePatchBaselines",
                                        "ssm:describePatchGroups",
                                        "ssm:listDocuments",
                                        "swf:describeActivityType",
                                        "swf:describeDomain",
                                        "swf:describeWorkflowExecution",
                                        "swf:describeWorkflowType",
                                        "swf:getWorkflowExecutionHistory",
                                        "swf:listActivityTypes",
                                        "swf:listClosedWorkflowExecutions",
                                        "swf:listDomains",
                                        "swf:listOpenWorkflowExecutions",
                                        "swf:listWorkflowTypes",
                                        "waf-regional:GetWebACL",
                                        "waf-regional:ListResourcesForWebACL",
                                        "waf-regional:ListWebACLs",
                                        "waf:getWebACL",
                                        "waf:listWebACLs",
                                        "ts:*",
                                        "iam:PassRole"
                                    ],
                                    "Effect": "Allow"
                                }
                            ]
                        },
                        "PolicyName": "DiagnosticTool_Permission"
                    }
                ],
                "AssumeRolePolicyDocument": {
                    "Version": "2012-10-17",
                    "Statement": [
                        {
                            "Condition": {},
                            "Action": "sts:AssumeRole",
                            "Effect": "Allow",
                            "Principal": {
                                "AWS": {"Fn::Join": ["", ["arn:aws:iam::",{"Ref": "PartnerAccountParameter"}, ":root"]]}
                            }
                        },
                        {
                            "Action": "sts:AssumeRole",
                            "Effect": "Allow",
                            "Principal": {
                                "Service": "ts.amazonaws.com"
                            }
                        }
                    ]
                }
            }
        }
    }
}